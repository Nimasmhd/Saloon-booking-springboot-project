<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customers - Lovely Salon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fdfaf5;
            --surface: #ffffff;
            --cream: #fffde7;
            --light-beige: #f5e9d9;
            --accent: #4a8c7d;
            --accent-dark: #3a6f63;
            --text: #4a4a4a;
            --text-light: #6b7280;
            --border: #f0e9df;
            --shadow-soft: 0 10px 30px rgba(0,0,0,0.05);
            --shadow-hover: 0 20px 50px rgba(0,0,0,0.08);
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, var(--cream) 100%);
            color: var(--text);
            line-height: 1.7;
        }
        .navbar {
            background: var(--surface) !important;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
        }
        .navbar-brand {
            font-weight: 700;
            color: var(--accent-dark) !important;
            font-size: 1.7rem;
        }
        .nav-link {
            color: var(--text-light) !important;
            font-weight: 500;
            padding: 0.75rem 1.5rem !important;
            border-radius: 999px;
            transition: all 0.3s ease;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--accent-dark) !important;
            background: var(--light-beige);
        }
        .page-header {
            padding: 6rem 0 4rem;
            background: linear-gradient(rgba(74,140,125,0.12), rgba(245,233,217,0.18)),
                        url('https://images.unsplash.com/photo-1598188309945-2be946cd1b0d?auto=format&fit=crop&q=80') center/cover;
            color: var(--accent-dark);
            text-align: center;
            position: relative;
        }
        .page-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(253,250,245,0.7);
        }
        .page-header h1, .page-header p { position: relative; }
        .page-header h1 { font-weight: 700; font-size: 3.2rem; }
        .table-container {
            background: var(--surface);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border);
        }
        .btn-primary {
            background: var(--accent);
            border: none;
            border-radius: 999px;
            padding: 0.6rem 1.5rem;
            font-weight: 600;
            transition: all 0.35s ease;
        }
        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(74,140,125,0.25);
        }
        .btn-danger, .btn-warning {
            border-radius: 999px;
        }
        .modal-content {
            border-radius: 24px;
            border: none;
            box-shadow: var(--shadow-hover);
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-leaf me-2"></i> Lovely Salon</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/services">Services</a></li>
                    <li class="nav-item"><a class="nav-link" href="/bookings">Bookings</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/customers">Customers</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <div class="container">
            <h1><i class="fas fa-users me-3"></i> Customers</h1>
            <p>Manage customer information</p>
        </div>
    </div>

    <div class="container mt-5">
        <div class="table-container">
            <div class="row mb-4">
                <div class="col-md-12">
                    <button id="addCustomerBtn" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i> Add New Customer
                    </button>
                </div>
            </div>

            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="customerTableBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Add/Edit Customer Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerModalTitle">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <input type="hidden" id="customerId">
                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="phone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="address" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    const API_URL = "http://localhost:8080/api/customers";

    function loadCustomers() {
        fetch(API_URL)
            .then(res => res.json())
            .then(customers => {
                const tbody = document.getElementById("customerTableBody");
                tbody.innerHTML = "";

                customers.forEach(c => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${c.customerId}</td>
                            <td>${c.name}</td>
                            <td>${c.email}</td>
                            <td>${c.phone}</td>
                            <td>${c.address || 'N/A'}</td>
                            <td>
                                <button class="btn btn-sm btn-warning mb-1" onclick="editCustomer(${c.customerId})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${c.customerId})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>`;
                });
            })
            .catch(err => console.error("Error loading customers:", err));
    }

    function editCustomer(id) {
        fetch(`${API_URL}/${id}`)
            .then(res => res.json())
            .then(c => {
                document.getElementById("customerId").value = c.customerId;
                document.getElementById("customerName").value = c.name;
                document.getElementById("email").value = c.email;
                document.getElementById("phone").value = c.phone;
                document.getElementById("address").value = c.address || '';
                document.getElementById("customerModalTitle").innerText = "Edit Customer";

                const modal = new bootstrap.Modal(document.getElementById("customerModal"));
                modal.show();
            });
    }

    function saveCustomer() {
        const id = document.getElementById("customerId").value;
        const customerData = {
            name: document.getElementById("customerName").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            address: document.getElementById("address").value
        };

        const method = id ? "PUT" : "POST";
        const url = id ? `${API_URL}/${id}` : API_URL;

        fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(customerData)
        })
        .then(res => {
            if (!res.ok) throw new Error("Failed");
            return res.json();
        })
        .then(() => {
            bootstrap.Modal.getInstance(document.getElementById("customerModal")).hide();
            document.getElementById("customerForm").reset();
            loadCustomers();
        })
        .catch(err => alert("Error saving customer"));
    }

    function deleteCustomer(id) {
        if (confirm("Delete this customer?")) {
            fetch(`${API_URL}/${id}`, { method: "DELETE" })
                .then(() => loadCustomers())
                .catch(err => alert("Error deleting customer"));
        }
    }

    document.getElementById("addCustomerBtn").addEventListener("click", () => {
        document.getElementById("customerForm").reset();
        document.getElementById("customerId").value = '';
        document.getElementById("customerModalTitle").innerText = "Add New Customer";

        const modal = new bootstrap.Modal(document.getElementById("customerModal"));
        modal.show();
    });

    loadCustomers();
    </script>
</body>
</html>
